<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PVP Ban</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #666769;
      color: #F0F0F0;
      margin: 0;
      padding: 0;
    }

    header {
      display: flex;
      justify-content: flex-end;
      padding: 10px;
    }

    button {
      padding: 10px 18px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin: 5px;
    }

    .section {
      margin: 20px;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    .highlight {
      background-color: #02491D;
    }

    table {
      border-collapse: collapse;
      margin-top: 10px;
      width: 100%;
    }

    th, td {
      border: 1px solid #999;
      padding: 6px;
      text-align: left;
    }

    /* Loading Screen */
    #loading-screen {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      text-align: center;
    }

    #app {
      display: none;
    }

    /* Dark Mode */
    .dark-mode {
      background: #1A252C;
      color: #f1f1f1;
    }

    .dark-mode .section {
      border: 1px solid #555;
    }

    .dark-mode table {
      border: 1px solid #555;
      background: #1e1e1e;
    }

    .dark-mode th,
    .dark-mode td {
      border: 1px solid #555;
      color: #f1f1f1;
    }

    .dark-mode .highlight {
      background: #023804;
    }

    .dark-mode button {
      background: #333;
      color: #f1f1f1;
    }
  </style>
</head>

<body>

<!-- Loading Screen -->
<div id="loading-screen">
  <img src="https://i.imgur.com/XZcfQzw.png" style="max-width:200px; margin-bottom:20px;">
  <p id="loadingText">Loading...</p>
</div>

<!-- App -->
<div id="app">

  <header>
    <button id="darkModeToggle">üåô Dark Mode</button>
  </header>

  <div class="section highlight">
    <h2>Mega Stone Check</h2>

    <div class="control-group">
      <select id="megaSelect">
        <option value="">Select Mega Stone</option>
      </select>

      <div class="button-group">
        <button id="megaSearchBtn">Search</button>
        <button id="megaResetBtn">Reset</button>
      </div>
    </div>

    <div id="megaResults"></div>
  </div>

  <div class="section">
    <h2>Pokemon PVP Check</h2>

    <div class="control-group">
      <input type="text" id="pvpInput" placeholder="Enter Pok√©mon name" />

      <div class="button-group">
        <button id="pvpSearchBtn">Search</button>
        <button id="pvpResetBtn">Reset</button>
      </div>
    </div>

    <div id="pvpResults"></div>
  </div>

</div>

</div>

<script>
  /* -------------------- Dark Mode -------------------- */
  const darkToggle = document.getElementById("darkModeToggle");

  darkToggle.addEventListener("click", () => {
    document.body.classList.toggle("dark-mode");
    darkToggle.textContent = document.body.classList.contains("dark-mode")
      ? "‚òÄÔ∏è Light Mode"
      : "üåô Dark Mode";
  });

  /* -------------------- Google Sheets -------------------- */
  const megaSheet =
    "https://docs.google.com/spreadsheets/d/e/2PACX-1vT8oRNGXyajLEDTw_z2AYgO5ls7TD9khstdBS2RL6PD9CwB06GKGM9dl2SerCRtSjSf5Y-8lo4sZ7UP/pub?output=csv";

  const pvpSheet =
    "https://docs.google.com/spreadsheets/d/e/2PACX-1vSp2K2rlJkpsFvuUWBjjiO-qpoJnfAx2vXJATqJYpK8fwmxuYBvKPihKvnPKChSt276QRjLkMlUTMgz/pub?output=csv";

  let megaData = [];
  let pvpData = [];

  /* -------------------- CSV Parser -------------------- */
  function parseCSV(text) {
    const rows = [];
    let current = [];
    let value = "";
    let insideQuotes = false;

    for (let i = 0; i < text.length; i++) {
      const char = text[i];

      if (char === '"' && text[i + 1] === '"') {
        value += '"';
        i++;
      } else if (char === '"') {
        insideQuotes = !insideQuotes;
      } else if (char === "," && !insideQuotes) {
        current.push(value.trim());
        value = "";
      } else if (char === "\n" && !insideQuotes) {
        current.push(value.trim());
        rows.push(current);
        current = [];
        value = "";
      } else {
        value += char;
      }
    }

    if (value.length) {
      current.push(value.trim());
      rows.push(current);
    }

    return rows;
  }

  async function fetchCSV(url) {
    const res = await fetch(url);
    const text = await res.text();
    return parseCSV(text);
  }

  /* -------------------- Load Data (Auto) -------------------- */
  async function loadData() {
    const [mega, pvp] = await Promise.all([
      fetchCSV(megaSheet),
      fetchCSV(pvpSheet)
    ]);

    megaData = mega;
    pvpData = pvp;

    const megaSelect = document.getElementById("megaSelect");
    megaSelect.innerHTML = '<option value="">Select Mega Stone</option>';

    [...new Set(megaData.slice(1).map(r => r[0]))].forEach(stone => {
      const opt = document.createElement("option");
      opt.value = stone;
      opt.textContent = stone;
      megaSelect.appendChild(opt);
    });
  }

  /* -------------------- Render Table -------------------- */
  function renderTable(headers, rows) {
    if (!rows.length) return "<p>No results found.</p>";

    let html = "<table><thead><tr>";
    headers.forEach(h => html += `<th>${h}</th>`);
    html += "</tr></thead><tbody>";

    rows.forEach(r => {
      html += "<tr>" + r.map(c => `<td>${c}</td>`).join("") + "</tr>";
    });

    html += "</tbody></table>";
    return html;
  }

  /* -------------------- Mega Stone Check -------------------- */
  document.getElementById("megaSearchBtn").addEventListener("click", () => {
    const stone = document.getElementById("megaSelect").value;
    const container = document.getElementById("megaResults");

    if (!stone) {
      container.innerHTML = "<p>Please select a mega stone.</p>";
      return;
    }

    const filtered = megaData
      .slice(1)
      .filter(r => r[0] === stone)
      .map(r => [
        r[1], // Pok√©mon (Spalte B)
        r[3], // OU (Spalte D)
        r[4]  // UU (Spalte E)
      ]);

    container.innerHTML = renderTable(
      ["Pok√©mon", "OU", "UU"],
      filtered
    );
  });

  document.getElementById("megaResetBtn").addEventListener("click", () => {
    document.getElementById("megaSelect").value = "";
    document.getElementById("megaResults").innerHTML = "";
  });

  /* -------------------- PvP Check -------------------- */
  document.getElementById("pvpSearchBtn").addEventListener("click", () => {
    const query = document.getElementById("pvpInput").value.trim().toLowerCase();
    const container = document.getElementById("pvpResults");

    if (!query) {
      container.innerHTML = "<p>Please enter a Pok√©mon name.</p>";
      return;
    }

    const rows = pvpData.slice(1).filter(r =>
      r[0] && r[0].toLowerCase().includes(query)
    );

    container.innerHTML = rows.length
      ? renderTable(pvpData[0], rows)
      : "<p>Currently not listed...</p>";
  });

  document.getElementById("pvpInput").addEventListener("keydown", e => {
    if (e.key === "Enter") {
      e.preventDefault();
      document.getElementById("pvpSearchBtn").click();
    }
  });

  document.getElementById("pvpResetBtn").addEventListener("click", () => {
    document.getElementById("pvpInput").value = "";
    document.getElementById("pvpResults").innerHTML = "";
  });

  /* -------------------- Auto Init -------------------- */
  window.addEventListener("load", async () => {
    await loadData();
    document.getElementById("loading-screen").style.display = "none";
    document.getElementById("app").style.display = "block";
  });
</script>

</body>
</html>
